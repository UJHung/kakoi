datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
  // output = "../src/generated/prisma"
  // runtime = "nodejs"
  // moduleFormat = "esm"
  // importFileExtension = ""
}

model Profile {
  id        String      @id           // 這裡可用 guestId 或 userId
  type      ProfileType @default(GUEST)
  createdAt DateTime    @default(now())
  cards     UserCard[]
}

enum ProfileType {
  GUEST
  USER
}

enum CardType {
  VISA
  MASTERCARD
  JCB
  AMEX
  UNIONPAY
  OTHER
}

enum CardLevel {
  LEVEL1
  LEVEL2
  LEVEL3
  VIP
  OTHER
}

model UserCard {
  id          String    @id @default(uuid())
  profileId   String
  cardId      String    // 對應 cards.json 中的 card.id
  nickname    String?   // 使用者自訂別名
  cardType    CardType? // 卡別 (Visa, Master, JCB...)
  cardLevel   CardLevel? // 等級
  expiryDate  DateTime? // 到期日
  billingDay  Int?      // 結賬日 (1-31)
  createdAt   DateTime  @default(now())
  
  profile     Profile   @relation(fields: [profileId], references: [id])

  @@index([profileId])
  @@index([cardId])  // 方便查詢特定卡片的用戶
}

